import{r as o,x as w,i as c,j as a}from"./index-CngvJ86W.js";import{C as v,a as u}from"./CRow-CtzMcsaN.js";import{C as O,a as Y}from"./CCardBody-lU-n6WEs.js";import{C as q}from"./CCardHeader-BT4ezZNC.js";import{a as d,d as G}from"./index.esm-CWyOyCyu.js";import{C as S}from"./CFormSelect-DQ6E9gX8.js";import{C as J,a as K,b as j,c as r,d as Q,e as l}from"./CTable-GyZHyXni.js";import{a as V,b as W,c as X,d as Z,e as _,f as ee}from"./DefaultLayout-3dDqqmB9.js";import"./CCloseButton-B3mKoNyB.js";import"./cil-user-C1CAzPmb.js";const pe=()=>{const[b,m]=o.useState([]),[T,y]=o.useState([]),[f,H]=o.useState(""),[p,I]=o.useState("all"),[B,i]=o.useState(!1),[h,M]=o.useState(null),[x,g]=o.useState("pending");o.useEffect(()=>{D(),F()},[]);const D=async()=>{try{const e=await w.get("https://backend-hr1.axleshift.com/api/employees");m(e.data.data??e.data)}catch(e){console.error("External fetch failed, trying local API...",e);try{const t=await c.get("/api/employee");m(t.data.data)}catch(t){console.error("Local fetch failed:",t)}}},F=async()=>{try{const e=await w.get("https://backend-hr1.axleshift.com/api/newhires");y(e.data.data??e.data)}catch(e){console.error("Error fetching new hires:",e)}},k=e=>`${e.firstName}${e.middleName?` ${e.middleName}`:""} ${e.lastName}`,$=e=>{const t={completed:"success","in progress":"warning",pending:"secondary"};return a.jsx(ee,{color:t[e]||"secondary",children:(e==null?void 0:e.charAt(0).toUpperCase())+(e==null?void 0:e.slice(1))})},R=e=>{M(e),g(e.status||"pending"),i(!0)},A=async()=>{if(h)try{await c.put(`/api/employee-training-status/${h.id}`,{status:x});const e=t=>t.map(n=>n.id===h.id?{...n,status:x}:n);m(e),y(e),i(!1)}catch(e){console.error("Error updating status:",e)}},C=[...b.map(e=>({...e,source:"regular"})),...T.map(e=>({...e,source:"new"}))],E=C.filter(e=>p==="new"?e.source==="new":p==="regular"?e.source==="regular":!0).filter(e=>[e.employeeId,e.firstName,e.middleName,e.lastName,e.position,e.department,e.email,e.dateHired].filter(Boolean).some(t=>t.toLowerCase().includes(f.toLowerCase()))),L=async()=>{var e;try{const n=(await c.get("/api/employee")).data.data,P=n.map(s=>s.employeeId),U=n.map(s=>s.email),z=C.filter(s=>!P.includes(s.employeeId)&&!U.includes(s.email));for(const s of z)try{await c.post("/api/employee",{employeeId:s.employeeId,lastName:s.lastName,firstName:s.firstName,middleName:s.middleName,position:s.position,department:s.department,dateHired:s.dateHired,email:s.email})}catch(N){console.error(`Error saving ${s.employeeId}:`,((e=N.response)==null?void 0:e.data)||N.message)}alert("Save completed.")}catch(t){console.error("Error saving employees:",t)}};return a.jsxs(a.Fragment,{children:[a.jsx(v,{children:a.jsx(u,{xs:12,children:a.jsxs(O,{className:"mb-4",children:[a.jsxs(q,{className:"d-flex justify-content-between align-items-center",children:[a.jsx("strong",{children:"Employee Management"}),a.jsx(d,{size:"sm",color:"success",onClick:L,children:"Save to Database"})]}),a.jsxs(Y,{children:[a.jsxs(v,{className:"mb-3",children:[a.jsx(u,{md:6,children:a.jsx(G,{placeholder:"Search by ID, name, position, department, etc...",value:f,onChange:e=>H(e.target.value)})}),a.jsx(u,{md:3,children:a.jsxs(S,{value:p,onChange:e=>I(e.target.value),children:[a.jsx("option",{value:"all",children:"All Employees"}),a.jsx("option",{value:"new",children:"New Hires Only"}),a.jsx("option",{value:"regular",children:"Regular Employees Only"})]})})]}),a.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:a.jsxs(J,{align:"middle",hover:!0,responsive:!0,className:"mb-0 border",children:[a.jsx(K,{children:a.jsxs(j,{children:[a.jsx(r,{children:"#"}),a.jsx(r,{children:"Employee ID"}),a.jsx(r,{children:"Name"}),a.jsx(r,{children:"Position"}),a.jsx(r,{children:"Department"}),a.jsx(r,{children:"Date Hired"}),a.jsx(r,{children:"Email"}),a.jsx(r,{className:"text-center",children:"Status"}),a.jsx(r,{className:"text-center",children:"Action"})]})}),a.jsx(Q,{children:E.length>0?E.map((e,t)=>a.jsxs(j,{children:[a.jsx(r,{children:t+1}),a.jsx(l,{children:e.employeeId}),a.jsx(l,{children:k(e)}),a.jsx(l,{children:e.position}),a.jsx(l,{children:e.department}),a.jsx(l,{children:e.dateHired}),a.jsx(l,{children:e.email}),a.jsx(l,{className:"text-center",children:$(e.status)}),a.jsx(l,{className:"text-center",children:a.jsx(d,{size:"sm",color:"primary",onClick:()=>R(e),children:"Edit Status"})})]},e.employeeId)):a.jsx(j,{children:a.jsx(l,{colSpan:9,className:"text-center",children:"No employees found."})})})]})})]})]})})}),a.jsxs(V,{visible:B,onClose:()=>i(!1),children:[a.jsx(W,{closeButton:!0,children:a.jsx(X,{children:"Edit Training Status"})}),a.jsx(Z,{children:a.jsxs(S,{value:x,onChange:e=>g(e.target.value),children:[a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"in progress",children:"In Progress"}),a.jsx("option",{value:"completed",children:"Completed"})]})}),a.jsxs(_,{children:[a.jsx(d,{color:"secondary",onClick:()=>i(!1),children:"Cancel"}),a.jsx(d,{color:"primary",onClick:A,children:"Save"})]})]})]})};export{pe as default};
