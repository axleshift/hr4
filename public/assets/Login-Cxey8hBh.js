import{r as o,_ as K,R as E,a as Q,c as W,P as j,b as X,m as Y,k as Z,j as s,C as ee,i as D,h as B}from"./index-Cq1t5o6K.js";import{b as se,e as F,d as U,a as oe}from"./index.esm-CYpXh0WE.js";import{C as H,a as M}from"./CRow-GMien-96.js";import{C as te}from"./CCardGroup-Cv_U5Wmt.js";import{C as ie,a as ne}from"./CCardBody-BBQGkKxr.js";import{C as re,c as ae}from"./cil-user-bTCGmmHe.js";import{u as le,T as ce,C as de}from"./CCloseButton-hIpAr8VW.js";import{C as V,a as $}from"./CInputGroupText-BfKI7auY.js";import{c as ue}from"./cil-lock-locked-DmxpJbVL.js";var q=o.forwardRef(function(e,a){var l=e.children,f=e.className,v=e.color,c=v===void 0?"primary":v,t=e.dismissible,u=e.variant,i=e.visible,n=i===void 0?!0:i,b=e.onClose,C=K(e,["children","className","color","dismissible","variant","visible","onClose"]),w=o.useRef(null),r=le(a,w),g=o.useState(n),p=g[0],m=g[1];return o.useEffect(function(){m(n)},[n]),E.createElement(ce,{in:p,mountOnEnter:!0,nodeRef:w,onExit:b,timeout:150,unmountOnExit:!0},function(h){return E.createElement("div",Q({className:W("alert",u==="solid"?"bg-".concat(c," text-white"):"alert-".concat(c),{"alert-dismissible fade":t,show:h==="entered"},f),role:"alert"},C,{ref:r}),l,t&&E.createElement(de,{onClick:function(){return m(!1)}}))})});q.propTypes={children:j.node,className:j.string,color:X.isRequired,dismissible:j.bool,onClose:j.func,variant:j.string,visible:j.bool};q.displayName="CAlert";function me(e={}){const{nonce:a,onScriptLoadSuccess:l,onScriptLoadError:f}=e,[v,c]=o.useState(!1),t=o.useRef(l);t.current=l;const u=o.useRef(f);return u.current=f,o.useEffect(()=>{const i=document.createElement("script");return i.src="https://accounts.google.com/gsi/client",i.async=!0,i.defer=!0,i.nonce=a,i.onload=()=>{var n;c(!0),(n=t.current)===null||n===void 0||n.call(t)},i.onerror=()=>{var n;c(!1),(n=u.current)===null||n===void 0||n.call(u)},document.body.appendChild(i),()=>{document.body.removeChild(i)}},[a]),v}const z=o.createContext(null);function ve({clientId:e,nonce:a,onScriptLoadSuccess:l,onScriptLoadError:f,children:v}){const c=me({nonce:a,onScriptLoadSuccess:l,onScriptLoadError:f}),t=o.useMemo(()=>({clientId:e,scriptLoadedSuccessfully:c}),[e,c]);return E.createElement(z.Provider,{value:t},v)}function fe(){const e=o.useContext(z);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}function ge(e){var a;return(a=e==null?void 0:e.clientId)!==null&&a!==void 0?a:e==null?void 0:e.client_id}const pe={large:40,medium:32,small:20};function he({onSuccess:e,onError:a,useOneTap:l,promptMomentNotification:f,type:v="standard",theme:c="outline",size:t="large",text:u,shape:i,logo_alignment:n,width:b,locale:C,click_listener:w,containerProps:r,...g}){const p=o.useRef(null),{clientId:m,scriptLoadedSuccessfully:h}=fe(),d=o.useRef(e);d.current=e;const S=o.useRef(a);S.current=a;const O=o.useRef(f);return O.current=f,o.useEffect(()=>{var I,L,N,R,G,k,T,A,P;if(h)return(N=(L=(I=window==null?void 0:window.google)===null||I===void 0?void 0:I.accounts)===null||L===void 0?void 0:L.id)===null||N===void 0||N.initialize({client_id:m,callback:x=>{var y;if(!(x!=null&&x.credential))return(y=S.current)===null||y===void 0?void 0:y.call(S);const{credential:_,select_by:J}=x;d.current({credential:_,clientId:ge(x),select_by:J})},...g}),(k=(G=(R=window==null?void 0:window.google)===null||R===void 0?void 0:R.accounts)===null||G===void 0?void 0:G.id)===null||k===void 0||k.renderButton(p.current,{type:v,theme:c,size:t,text:u,shape:i,logo_alignment:n,width:b,locale:C,click_listener:w}),l&&((P=(A=(T=window==null?void 0:window.google)===null||T===void 0?void 0:T.accounts)===null||A===void 0?void 0:A.id)===null||P===void 0||P.prompt(O.current)),()=>{var x,y,_;l&&((_=(y=(x=window==null?void 0:window.google)===null||x===void 0?void 0:x.accounts)===null||y===void 0?void 0:y.id)===null||_===void 0||_.cancel())}},[m,h,l,v,c,t,u,i,n,b,C]),E.createElement("div",{...r,ref:p,style:{height:pe[t],...r==null?void 0:r.style}})}const Ie=()=>{const[e,a]=o.useState(""),[l,f]=o.useState(""),[v,c]=o.useState(!1),[t,u]=o.useState({visible:!1,type:"",message:""}),i=Y(),n=Z(),b=async r=>{var g,p;r.preventDefault(),c(!0);try{const m=await D.post("https://backend-admin.axleshift.com/integ/external-login/HR",{email:e,password:l}),{token:h,user:d}=m.data;i({type:"SET_USER",payload:d}),i({type:"SET_SESSION_ID",payload:h}),B.set("external_token",h,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("external_token",h),sessionStorage.setItem("role",d.role),sessionStorage.setItem("user_id",d.id),sessionStorage.setItem("name",d.name),sessionStorage.setItem("email",d.email),n("/dashboard")}catch(m){u({visible:!0,type:"danger",message:((p=(g=m.response)==null?void 0:g.data)==null?void 0:p.message)||"Login failed. Please try again."})}finally{c(!1)}},C=async r=>{var g,p;try{const{credential:m}=r,h=await D.post("/api/auth/google",{token:m}),{user:d,session_id:S}=h.data;i({type:"SET_USER",payload:d}),i({type:"SET_SESSION_ID",payload:S}),B.set("session_id",S,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("session_id",S),sessionStorage.setItem("role",d.role),sessionStorage.setItem("user_id",d.id),sessionStorage.setItem("name",d.name),sessionStorage.setItem("email",d.email),n("/dashboard")}catch(m){u({visible:!0,type:"danger",message:((p=(g=m.response)==null?void 0:g.data)==null?void 0:p.message)||"Google Login failed. Please try again."})}},w=r=>{u({visible:!0,type:"danger",message:"Google login failed. Please try again."})};return o.useEffect(()=>{if(t.visible){const r=setTimeout(()=>u({...t,visible:!1}),3e3);return()=>clearTimeout(r)}},[t]),s.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:s.jsx(se,{children:s.jsx(H,{className:"justify-content-center",children:s.jsx(M,{md:8,children:s.jsx(te,{children:s.jsx(ie,{className:"p-4",children:s.jsxs(ne,{children:[s.jsxs(re,{onSubmit:b,children:[s.jsx("h1",{children:"Login"}),s.jsx("p",{className:"text-body-secondary",children:"Sign in to your account"}),t.visible&&s.jsx(q,{color:t.type,children:t.message}),s.jsxs(V,{className:"mb-3",children:[s.jsx($,{children:s.jsx(F,{icon:ae})}),s.jsx(U,{type:"email",placeholder:"Email",value:e,onChange:r=>a(r.target.value),required:!0})]}),s.jsxs(V,{className:"mb-3",children:[s.jsx($,{children:s.jsx(F,{icon:ue})}),s.jsx(U,{type:"password",placeholder:"Password",value:l,onChange:r=>f(r.target.value),required:!0})]}),s.jsx(H,{children:s.jsx(M,{xs:6,children:s.jsx(oe,{type:"submit",color:"primary",disabled:v,children:v?s.jsx(ee,{size:"sm"}):"Login"})})})]}),s.jsx("div",{className:"mt-3",children:s.jsx(ve,{clientId:"417979810176-9n90pqqm735jisrjnqlejt5hqtcnm7mu.apps.googleusercontent.com",children:s.jsx(he,{onSuccess:C,onError:w})})})]})})})})})})})};export{Ie as default};
