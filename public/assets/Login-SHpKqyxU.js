import{r,_ as T,R as j,a as _,c as k,P as o,b as P,k as G,h as q,j as e,C as A,q as B,v as D}from"./index-QrK95apx.js";import{b as F,e as N,d as w,a as R}from"./index.esm-WA_nC703.js";import{C as y,a as S}from"./CRow-DDEi3Us-.js";import{C as O}from"./CCardGroup-MTFnb51K.js";import{C as U,a as z}from"./CCardBody-C99OnEUD.js";import{C as V,c as $}from"./cil-user-Bs5JOMhL.js";import{u as H,T as J,C as K}from"./CCloseButton-DL7tO56S.js";import{C as I,a as L}from"./CInputGroupText-s1lgo7Tv.js";import{c as M}from"./cil-lock-locked-DmxpJbVL.js";var E=r.forwardRef(function(s,g){var f=s.children,C=s.className,n=s.color,l=n===void 0?"primary":n,t=s.dismissible,h=s.variant,c=s.visible,d=c===void 0?!0:c,b=s.onClose,v=T(s,["children","className","color","dismissible","variant","visible","onClose"]),a=r.useRef(null),x=H(g,a),m=r.useState(d),u=m[0],i=m[1];return r.useEffect(function(){i(d)},[d]),j.createElement(J,{in:u,mountOnEnter:!0,nodeRef:a,onExit:b,timeout:150,unmountOnExit:!0},function(p){return j.createElement("div",_({className:k("alert",h==="solid"?"bg-".concat(l," text-white"):"alert-".concat(l),{"alert-dismissible fade":t,show:p==="entered"},C),role:"alert"},v,{ref:x}),f,t&&j.createElement(K,{onClick:function(){return i(!1)}}))})});E.propTypes={children:o.node,className:o.string,color:P.isRequired,dismissible:o.bool,onClose:o.func,variant:o.string,visible:o.bool};E.displayName="CAlert";const re=()=>{const[s,g]=r.useState(""),[f,C]=r.useState(""),[n,l]=r.useState(!1),[t,h]=r.useState({visible:!1,type:"",message:""}),c=G(),d=q(),b=async a=>{var x,m;a.preventDefault(),l(!0);try{const u=await B.post("/api/auth/login",{email:s,password:f}),{user:i,session_id:p}=u.data;c({type:"SET_USER",payload:i}),c({type:"SET_SESSION_ID",payload:p}),D.set("session_id",p,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("session_id",p),sessionStorage.setItem("role",i.role),sessionStorage.setItem("user_id",i.id),sessionStorage.setItem("name",i.name),sessionStorage.setItem("email",i.email),d("/dashboard")}catch(u){h({visible:!0,type:"danger",message:((m=(x=u.response)==null?void 0:x.data)==null?void 0:m.message)||"Login failed. Please try again."})}finally{l(!1)}},v=()=>{window.location.href="/auth/google"};return r.useEffect(()=>{if(t.visible){const a=setTimeout(()=>h({...t,visible:!1}),3e3);return()=>clearTimeout(a)}},[t]),e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(F,{children:e.jsx(y,{className:"justify-content-center",children:e.jsx(S,{md:8,children:e.jsx(O,{children:e.jsx(U,{className:"p-4",children:e.jsxs(z,{children:[e.jsxs(V,{onSubmit:b,children:[e.jsx("h1",{children:"Login"}),e.jsx("p",{className:"text-body-secondary",children:"Sign in to your account"}),t.visible&&e.jsx(E,{color:t.type,children:t.message}),e.jsxs(I,{className:"mb-3",children:[e.jsx(L,{children:e.jsx(N,{icon:$})}),e.jsx(w,{type:"email",placeholder:"Email",value:s,onChange:a=>g(a.target.value),required:!0})]}),e.jsxs(I,{className:"mb-3",children:[e.jsx(L,{children:e.jsx(N,{icon:M})}),e.jsx(w,{type:"password",placeholder:"Password",value:f,onChange:a=>C(a.target.value),required:!0})]}),e.jsx(y,{children:e.jsx(S,{xs:6,children:e.jsx(R,{type:"submit",color:"primary",disabled:n,children:n?e.jsx(A,{size:"sm"}):"Login"})})})]}),e.jsx(y,{className:"mt-3",children:e.jsx(S,{xs:12,children:e.jsx(R,{color:"danger",onClick:v,block:!0,children:"Login with Google"})})})]})})})})})})})};export{re as default};
