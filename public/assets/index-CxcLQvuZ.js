import{r as d,j as e,h as j,P as n}from"./index-CVIqvtcL.js";import{c as l,a as g,d as F}from"./index.esm-sv4OaudS.js";import{a as T,b as w,c as A,d as U}from"./DefaultLayout-BBSitc20.js";import{C as M}from"./CModalTitle-wfaYqSMz.js";import{C as P}from"./CForm-D0vq6dH-.js";import{C as c}from"./CFormInput-DN6r8bz0.js";import{C as R}from"./CFormSelect-CPHBfyKK.js";import{C as H,a as k}from"./CRow-CfuXGCqi.js";import{C as B,a as O}from"./CCardBody-DordWXWb.js";import{C as z}from"./CCardHeader-Duo_5ltD.js";import{c as I}from"./cil-user-plus-9sfVD_63.js";import{C as V,a as $,b as S,c as x,d as G,e as u}from"./CTable-B_DR6iz3.js";import{c as L}from"./cil-options-sHCm5Gxk.js";import"./CCloseButton-BXuWBn7H.js";import"./cil-user-Ddrdy7PS.js";const D=({modalVisible:b,setModalVisible:h,user:a,fetchUsers:v,roles:p,departments:N})=>{const[t,f]=d.useState({name:"",email:"",role:"",department:"",employee_type:"",employment_status:"",date_of_hire:"",gender:"",phone_number:"",address:""}),[o,y]=d.useState({});d.useEffect(()=>{a&&f({name:a.name||"",email:a.email||"",role:a.role_id||"",department:a.department?a.department.id:"",employee_type:a.employee_type||"",employment_status:a.employment_status||"",date_of_hire:a.date_of_hire||"",gender:a.gender||"",phone_number:a.phone_number||"",address:a.address||""})},[a]);const i=s=>{const{name:r,value:m}=s.target;f(_=>({..._,[r]:m}))},E=()=>{const s={};return t.name||(s.name="Name is required"),t.email||(s.email="Email is required"),t.role||(s.role="Role is required"),t.department||(s.department="Department is required"),t.date_of_hire||(s.date_of_hire="Date of hire is required"),y(s),Object.keys(s).length===0},C=async s=>{if(s.preventDefault(),!!E())try{await j.put(`/api/users/${a.id}`,t),v(),h(!1)}catch(r){console.error("Error updating user profile:",r)}};return e.jsxs(T,{visible:b,onClose:()=>h(!1),size:"lg",children:[e.jsx(w,{children:e.jsx(M,{children:"Edit Profile"})}),e.jsx(A,{children:e.jsxs(P,{onSubmit:C,children:[e.jsx(l,{htmlFor:"name",children:"Full Name"}),e.jsx(c,{id:"name",name:"name",value:t.name,onChange:i,invalid:!!o.name}),o.name&&e.jsx("div",{className:"text-danger",children:o.name}),e.jsx(l,{htmlFor:"email",children:"Email"}),e.jsx(c,{id:"email",name:"email",value:t.email,readOnly:!0,invalid:!!o.email}),o.email&&e.jsx("div",{className:"text-danger",children:o.email}),e.jsx(l,{htmlFor:"role",children:"Role"}),e.jsxs(R,{id:"role",name:"role",value:t.role,onChange:i,invalid:!!o.role,children:[e.jsx("option",{value:"",children:"Select Role"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),o.role&&e.jsx("div",{className:"text-danger",children:o.role}),e.jsx(l,{htmlFor:"department",children:"Department"}),e.jsxs(R,{id:"department",name:"department",value:t.department,onChange:i,invalid:!!o.department,children:[e.jsx("option",{value:"",children:"Select Department"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),o.department&&e.jsx("div",{className:"text-danger",children:o.department}),e.jsx(l,{htmlFor:"employee_type",children:"Employee Type"}),e.jsx(c,{id:"employee_type",name:"employee_type",value:t.employee_type,onChange:i}),e.jsx(l,{htmlFor:"employment_status",children:"Employment Status"}),e.jsx(c,{id:"employment_status",name:"employment_status",value:t.employment_status,onChange:i}),e.jsx(l,{htmlFor:"date_of_hire",children:"Date of Hire"}),e.jsx(c,{id:"date_of_hire",name:"date_of_hire",type:"date",value:t.date_of_hire,onChange:i,invalid:!!o.date_of_hire}),o.date_of_hire&&e.jsx("div",{className:"text-danger",children:o.date_of_hire}),e.jsx(l,{htmlFor:"gender",children:"Gender"}),e.jsx(c,{id:"gender",name:"gender",value:t.gender,onChange:i}),e.jsx(l,{htmlFor:"phone_number",children:"Phone Number"}),e.jsx(c,{id:"phone_number",name:"phone_number",value:t.phone_number,onChange:i}),e.jsx(l,{htmlFor:"address",children:"Address"}),e.jsx(c,{id:"address",name:"address",value:t.address,onChange:i})]})}),e.jsxs(U,{children:[e.jsx(g,{color:"secondary",onClick:()=>h(!1),children:"Close"}),e.jsx(g,{color:"primary",onClick:C,children:"Save Changes"})]})]})};D.propTypes={modalVisible:n.bool.isRequired,setModalVisible:n.func.isRequired,user:n.shape({id:n.number.isRequired,name:n.string,email:n.string,role_id:n.number,department:n.shape({id:n.number,name:n.string}),employee_type:n.string,employment_status:n.string,date_of_hire:n.string,gender:n.string,phone_number:n.string,address:n.string}).isRequired,fetchUsers:n.func.isRequired,roles:n.array.isRequired,departments:n.array.isRequired};const le=()=>{const[b,h]=d.useState([]),[a,v]=d.useState([]),[p,N]=d.useState([]),[t,f]=d.useState(null),[o,y]=d.useState(!1);d.useEffect(()=>{E(),C()},[]),d.useEffect(()=>{a.length>0&&p.length>0&&i()},[a,p]);const i=async()=>{try{const r=await j.get("/api/users");h(r.data.data)}catch(r){console.error("Error fetching users:",r)}},E=async()=>{try{const r=await j.get("/api/roles");v(r.data)}catch(r){console.error("Error fetching roles:",r)}},C=async()=>{try{const r=await j.get("/api/departments");N(r.data)}catch(r){console.error("Error fetching departments:",r)}},s=async r=>{try{const m=await j.get(`/api/users/${r}`);f(m.data.data),y(!0)}catch(m){console.error("Error fetching user profile:",m)}};return e.jsxs(H,{children:[e.jsx(k,{xs:12,children:e.jsxs(B,{className:"mb-4",children:[e.jsxs(z,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Access Control"}),e.jsxs(g,{color:"primary",children:[e.jsx(F,{icon:I,className:"me-2"}),"Add User"]})]}),e.jsx(O,{children:e.jsxs(V,{align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Email"}),e.jsx(x,{className:"text-center",children:"Role"}),e.jsx(x,{className:"text-center",children:"Department"}),e.jsx(x,{className:"text-center",children:"Actions"})]})}),e.jsx(G,{children:b.map(r=>{var m,_;return e.jsxs(S,{children:[e.jsx(u,{children:r.name}),e.jsx(u,{children:r.email}),e.jsx(u,{className:"text-center",children:a&&Array.isArray(a)&&((m=a.find(q=>q.id===r.role_id))==null?void 0:m.name)||"N/A"}),e.jsx(u,{className:"text-center",children:((_=r.department)==null?void 0:_.name)||"No Department"}),e.jsx(u,{className:"text-center",children:e.jsxs(g,{color:"secondary",size:"sm",onClick:()=>s(r.id),children:[e.jsx(F,{icon:L,className:"me-1"}),"More"]})})]},r.id)})})]})})]})}),t&&e.jsx(D,{modalVisible:o,setModalVisible:y,user:t,fetchUsers:i,roles:a,departments:p})]})};export{le as default};
