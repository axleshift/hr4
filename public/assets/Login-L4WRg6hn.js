import{r as i,_ as J,R as E,a as K,c as Q,P as _,b as W,k as X,h as Y,j as e,C as Z,q,v as B}from"./index-qmQ_-s3F.js";import{b as ee,e as F,d as U,a as se}from"./index.esm-1O7AWSxw.js";import{C as H,a as M}from"./CRow-BvpW4L1D.js";import{C as oe}from"./CCardGroup-Bj2PPqCj.js";import{C as ie,a as te}from"./CCardBody-u-6v-S3t.js";import{C as ne,c as ae}from"./cil-user-B7EsN_Hn.js";import{u as re,T as le,C as de}from"./CCloseButton-CdNJiJtS.js";import{C as V,a as $}from"./CInputGroupText-BjNQ_FYp.js";import{c as ce}from"./cil-lock-locked-DmxpJbVL.js";var P=i.forwardRef(function(s,l){var m=s.children,b=s.className,p=s.color,h=p===void 0?"primary":p,t=s.dismissible,v=s.variant,d=s.visible,g=d===void 0?!0:d,y=s.onClose,w=J(s,["children","className","color","dismissible","variant","visible","onClose"]),S=i.useRef(null),o=re(l,S),c=i.useState(g),u=c[0],n=c[1];return i.useEffect(function(){n(g)},[g]),E.createElement(le,{in:u,mountOnEnter:!0,nodeRef:S,onExit:y,timeout:150,unmountOnExit:!0},function(a){return E.createElement("div",K({className:Q("alert",v==="solid"?"bg-".concat(h," text-white"):"alert-".concat(h),{"alert-dismissible fade":t,show:a==="entered"},b),role:"alert"},w,{ref:o}),m,t&&E.createElement(de,{onClick:function(){return n(!1)}}))})});P.propTypes={children:_.node,className:_.string,color:W.isRequired,dismissible:_.bool,onClose:_.func,variant:_.string,visible:_.bool};P.displayName="CAlert";const ue=i.createContext(null);function me(){const s=i.useContext(ue);if(!s)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return s}function ve(s){var l;return(l=s==null?void 0:s.clientId)!==null&&l!==void 0?l:s==null?void 0:s.client_id}const ge={large:40,medium:32,small:20};function fe({onSuccess:s,onError:l,useOneTap:m,promptMomentNotification:b,type:p="standard",theme:h="outline",size:t="large",text:v,shape:d,logo_alignment:g,width:y,locale:w,click_listener:S,containerProps:o,...c}){const u=i.useRef(null),{clientId:n,scriptLoadedSuccessfully:a}=me(),r=i.useRef(s);r.current=s;const x=i.useRef(l);x.current=l;const D=i.useRef(b);return D.current=b,i.useEffect(()=>{var I,N,G,R,L,T,k,A,O;if(a)return(G=(N=(I=window==null?void 0:window.google)===null||I===void 0?void 0:I.accounts)===null||N===void 0?void 0:N.id)===null||G===void 0||G.initialize({client_id:n,callback:f=>{var C;if(!(f!=null&&f.credential))return(C=x.current)===null||C===void 0?void 0:C.call(x);const{credential:j,select_by:z}=f;r.current({credential:j,clientId:ve(f),select_by:z})},...c}),(T=(L=(R=window==null?void 0:window.google)===null||R===void 0?void 0:R.accounts)===null||L===void 0?void 0:L.id)===null||T===void 0||T.renderButton(u.current,{type:p,theme:h,size:t,text:v,shape:d,logo_alignment:g,width:y,locale:w,click_listener:S}),m&&((O=(A=(k=window==null?void 0:window.google)===null||k===void 0?void 0:k.accounts)===null||A===void 0?void 0:A.id)===null||O===void 0||O.prompt(D.current)),()=>{var f,C,j;m&&((j=(C=(f=window==null?void 0:window.google)===null||f===void 0?void 0:f.accounts)===null||C===void 0?void 0:C.id)===null||j===void 0||j.cancel())}},[n,a,m,p,h,t,v,d,g,y,w]),E.createElement("div",{...o,ref:u,style:{height:ge[t],...o==null?void 0:o.style}})}const je=()=>{const[s,l]=i.useState(""),[m,b]=i.useState(""),[p,h]=i.useState(!1),[t,v]=i.useState({visible:!1,type:"",message:""}),d=X(),g=Y(),y=async o=>{var c,u;o.preventDefault(),h(!0);try{const n=await q.post("/api/auth/login",{email:s,password:m}),{user:a,session_id:r}=n.data;d({type:"SET_USER",payload:a}),d({type:"SET_SESSION_ID",payload:r}),B.set("session_id",r,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("session_id",r),sessionStorage.setItem("role",a.role),sessionStorage.setItem("user_id",a.id),sessionStorage.setItem("name",a.name),sessionStorage.setItem("email",a.email),g("/dashboard")}catch(n){v({visible:!0,type:"danger",message:((u=(c=n.response)==null?void 0:c.data)==null?void 0:u.message)||"Login failed. Please try again."})}finally{h(!1)}},w=async o=>{var c,u;try{const{credential:n}=o,a=await q.post("/api/auth/google",{token:n}),{user:r,session_id:x}=a.data;d({type:"SET_USER",payload:r}),d({type:"SET_SESSION_ID",payload:x}),B.set("session_id",x,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("session_id",x),sessionStorage.setItem("role",r.role),sessionStorage.setItem("user_id",r.id),sessionStorage.setItem("name",r.name),sessionStorage.setItem("email",r.email),g("/dashboard")}catch(n){v({visible:!0,type:"danger",message:((u=(c=n.response)==null?void 0:c.data)==null?void 0:u.message)||"Google Login failed. Please try again."})}},S=o=>{v({visible:!0,type:"danger",message:"Google login failed. Please try again."})};return i.useEffect(()=>{if(t.visible){const o=setTimeout(()=>v({...t,visible:!1}),3e3);return()=>clearTimeout(o)}},[t]),e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(ee,{children:e.jsx(H,{className:"justify-content-center",children:e.jsx(M,{md:8,children:e.jsx(oe,{children:e.jsx(ie,{className:"p-4",children:e.jsxs(te,{children:[e.jsxs(ne,{onSubmit:y,children:[e.jsx("h1",{children:"Login"}),e.jsx("p",{className:"text-body-secondary",children:"Sign in to your account"}),t.visible&&e.jsx(P,{color:t.type,children:t.message}),e.jsxs(V,{className:"mb-3",children:[e.jsx($,{children:e.jsx(F,{icon:ae})}),e.jsx(U,{type:"email",placeholder:"Email",value:s,onChange:o=>l(o.target.value),required:!0})]}),e.jsxs(V,{className:"mb-3",children:[e.jsx($,{children:e.jsx(F,{icon:ce})}),e.jsx(U,{type:"password",placeholder:"Password",value:m,onChange:o=>b(o.target.value),required:!0})]}),e.jsx(H,{children:e.jsx(M,{xs:6,children:e.jsx(se,{type:"submit",color:"primary",disabled:p,children:p?e.jsx(Z,{size:"sm"}):"Login"})})})]}),e.jsx("div",{className:"mt-3",children:e.jsx(fe,{onSuccess:w,onError:S})})]})})})})})})})};export{je as default};
