import{r,_ as T,R as v,a as _,c as L,P as l,b as P,i as k,u as q,j as e,C as A,o as B,q as D}from"./index-EK1oDtQo.js";import{b as F,d as j,a as G}from"./index.esm-DTqtlBIJ.js";import{C as S,a as E}from"./CRow-C-nD_8v1.js";import{C as O}from"./CCardGroup-R6xV7aB6.js";import{C as U,a as z}from"./CCardBody-CXXmE4BX.js";import{C as V}from"./CForm-D3Iuq08t.js";import{u as $,T as H,C as J}from"./CCloseButton-B0J24H2U.js";import{C as N,a as R}from"./CInputGroupText-D3ty-fyS.js";import{c as K}from"./cil-user-Ddrdy7PS.js";import{C as I}from"./CFormInput-B199oAcv.js";import{c as M}from"./cil-lock-locked-DmxpJbVL.js";var y=r.forwardRef(function(s,x){var f=s.children,g=s.className,c=s.color,d=c===void 0?"primary":c,a=s.dismissible,C=s.variant,m=s.visible,u=m===void 0?!0:m,b=s.onClose,t=T(s,["children","className","color","dismissible","variant","visible","onClose"]),p=r.useRef(null),h=$(x,p),o=r.useState(u),i=o[0],n=o[1];return r.useEffect(function(){n(u)},[u]),v.createElement(H,{in:i,mountOnEnter:!0,nodeRef:p,onExit:b,timeout:150,unmountOnExit:!0},function(w){return v.createElement("div",_({className:L("alert",C==="solid"?"bg-".concat(d," text-white"):"alert-".concat(d),{"alert-dismissible fade":a,show:w==="entered"},g),role:"alert"},t,{ref:h}),f,a&&v.createElement(J,{onClick:function(){return n(!1)}}))})});y.propTypes={children:l.node,className:l.string,color:P.isRequired,dismissible:l.bool,onClose:l.func,variant:l.string,visible:l.bool};y.displayName="CAlert";const oe=()=>{const[s,x]=r.useState(""),[f,g]=r.useState(""),[c,d]=r.useState(!1),[a,C]=r.useState({visible:!1,type:"",message:""}),m=k(),u=q(),b=async t=>{var p,h;t.preventDefault(),d(!0);try{const o=await B.post("/api/auth/login",{email:s,password:f}),{user:i,session_id:n}=o.data;m({type:"SET_USER",payload:i}),m({type:"SET_SESSION_ID",payload:n}),D.set("session_id",n,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("session_id",n),sessionStorage.setItem("role",i.role),sessionStorage.setItem("user_id",i.id),sessionStorage.setItem("name",i.name),sessionStorage.setItem("email",i.email),u("/dashboard")}catch(o){C({visible:!0,type:"danger",message:((h=(p=o.response)==null?void 0:p.data)==null?void 0:h.message)||"Login failed. Please try again."})}finally{d(!1)}};return r.useEffect(()=>{if(a.visible){const t=setTimeout(()=>C({...a,visible:!1}),3e3);return()=>clearTimeout(t)}},[a]),e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(F,{children:e.jsx(S,{className:"justify-content-center",children:e.jsx(E,{md:8,children:e.jsx(O,{children:e.jsx(U,{className:"p-4",children:e.jsx(z,{children:e.jsxs(V,{onSubmit:b,children:[e.jsx("h1",{children:"Login"}),e.jsx("p",{className:"text-body-secondary",children:"Sign in to your account"}),a.visible&&e.jsx(y,{color:a.type,children:a.message}),e.jsxs(N,{className:"mb-3",children:[e.jsx(R,{children:e.jsx(j,{icon:K})}),e.jsx(I,{type:"email",placeholder:"Email",value:s,onChange:t=>x(t.target.value),required:!0})]}),e.jsxs(N,{className:"mb-3",children:[e.jsx(R,{children:e.jsx(j,{icon:M})}),e.jsx(I,{type:"password",placeholder:"Password",value:f,onChange:t=>g(t.target.value),required:!0})]}),e.jsx(S,{children:e.jsx(E,{xs:6,children:e.jsx(G,{type:"submit",color:"primary",disabled:c,children:c?e.jsx(A,{size:"sm"}):"Login"})})})]})})})})})})})})};export{oe as default};
