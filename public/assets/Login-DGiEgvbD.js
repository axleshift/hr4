import{r as o,_ as K,R as E,a as Q,c as W,P as _,b as X,k as Y,h as Z,j as s,C as ee,q as D,v as B}from"./index-Bh88rFDL.js";import{b as se,e as F,d as U,a as oe}from"./index.esm-DRuiXNQ-.js";import{C as M,a as V}from"./CRow-jO2NlhCr.js";import{C as te}from"./CCardGroup-CWDurlXl.js";import{C as ie,a as ne}from"./CCardBody-M0MFjdp8.js";import{C as re,c as ae}from"./cil-user-UShTQDOr.js";import{u as le,T as ce,C as de}from"./CCloseButton-BjA9ruey.js";import{C as H,a as $}from"./CInputGroupText-GsSPetdk.js";import{c as ue}from"./cil-lock-locked-DmxpJbVL.js";var P=o.forwardRef(function(e,a){var l=e.children,g=e.className,m=e.color,c=m===void 0?"primary":m,t=e.dismissible,d=e.variant,i=e.visible,n=i===void 0?!0:i,C=e.onClose,b=K(e,["children","className","color","dismissible","variant","visible","onClose"]),w=o.useRef(null),r=le(a,w),p=o.useState(n),h=p[0],u=p[1];return o.useEffect(function(){u(n)},[n]),E.createElement(ce,{in:h,mountOnEnter:!0,nodeRef:w,onExit:C,timeout:150,unmountOnExit:!0},function(v){return E.createElement("div",Q({className:W("alert",d==="solid"?"bg-".concat(c," text-white"):"alert-".concat(c),{"alert-dismissible fade":t,show:v==="entered"},g),role:"alert"},b,{ref:r}),l,t&&E.createElement(de,{onClick:function(){return u(!1)}}))})});P.propTypes={children:_.node,className:_.string,color:X.isRequired,dismissible:_.bool,onClose:_.func,variant:_.string,visible:_.bool};P.displayName="CAlert";function me(e={}){const{nonce:a,onScriptLoadSuccess:l,onScriptLoadError:g}=e,[m,c]=o.useState(!1),t=o.useRef(l);t.current=l;const d=o.useRef(g);return d.current=g,o.useEffect(()=>{const i=document.createElement("script");return i.src="https://accounts.google.com/gsi/client",i.async=!0,i.defer=!0,i.nonce=a,i.onload=()=>{var n;c(!0),(n=t.current)===null||n===void 0||n.call(t)},i.onerror=()=>{var n;c(!1),(n=d.current)===null||n===void 0||n.call(d)},document.body.appendChild(i),()=>{document.body.removeChild(i)}},[a]),m}const z=o.createContext(null);function ve({clientId:e,nonce:a,onScriptLoadSuccess:l,onScriptLoadError:g,children:m}){const c=me({nonce:a,onScriptLoadSuccess:l,onScriptLoadError:g}),t=o.useMemo(()=>({clientId:e,scriptLoadedSuccessfully:c}),[e,c]);return E.createElement(z.Provider,{value:t},m)}function fe(){const e=o.useContext(z);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}function ge(e){var a;return(a=e==null?void 0:e.clientId)!==null&&a!==void 0?a:e==null?void 0:e.client_id}const pe={large:40,medium:32,small:20};function he({onSuccess:e,onError:a,useOneTap:l,promptMomentNotification:g,type:m="standard",theme:c="outline",size:t="large",text:d,shape:i,logo_alignment:n,width:C,locale:b,click_listener:w,containerProps:r,...p}){const h=o.useRef(null),{clientId:u,scriptLoadedSuccessfully:v}=fe(),f=o.useRef(e);f.current=e;const y=o.useRef(a);y.current=a;const O=o.useRef(g);return O.current=g,o.useEffect(()=>{var I,L,N,R,G,T,k,q,A;if(v)return(N=(L=(I=window==null?void 0:window.google)===null||I===void 0?void 0:I.accounts)===null||L===void 0?void 0:L.id)===null||N===void 0||N.initialize({client_id:u,callback:S=>{var x;if(!(S!=null&&S.credential))return(x=y.current)===null||x===void 0?void 0:x.call(y);const{credential:j,select_by:J}=S;f.current({credential:j,clientId:ge(S),select_by:J})},...p}),(T=(G=(R=window==null?void 0:window.google)===null||R===void 0?void 0:R.accounts)===null||G===void 0?void 0:G.id)===null||T===void 0||T.renderButton(h.current,{type:m,theme:c,size:t,text:d,shape:i,logo_alignment:n,width:C,locale:b,click_listener:w}),l&&((A=(q=(k=window==null?void 0:window.google)===null||k===void 0?void 0:k.accounts)===null||q===void 0?void 0:q.id)===null||A===void 0||A.prompt(O.current)),()=>{var S,x,j;l&&((j=(x=(S=window==null?void 0:window.google)===null||S===void 0?void 0:S.accounts)===null||x===void 0?void 0:x.id)===null||j===void 0||j.cancel())}},[u,v,l,m,c,t,d,i,n,C,b]),E.createElement("div",{...r,ref:h,style:{height:pe[t],...r==null?void 0:r.style}})}const Ie=()=>{const[e,a]=o.useState(""),[l,g]=o.useState(""),[m,c]=o.useState(!1),[t,d]=o.useState({visible:!1,type:"",message:""}),i=Y(),n=Z(),C=async r=>{var p,h;r.preventDefault(),c(!0);try{const u=await D.post("/api/auth/login",{email:e,password:l}),{user:v,session_id:f}=u.data;i({type:"SET_USER",payload:v}),i({type:"SET_SESSION_ID",payload:f}),B.set("session_id",f,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("session_id",f),sessionStorage.setItem("role",v.role),sessionStorage.setItem("user_id",v.id),sessionStorage.setItem("name",v.name),sessionStorage.setItem("email",v.email),n("/dashboard")}catch(u){d({visible:!0,type:"danger",message:((h=(p=u.response)==null?void 0:p.data)==null?void 0:h.message)||"Login failed. Please try again."})}finally{c(!1)}},b=async r=>{var p,h;try{const{credential:u}=r,v=await D.post("/api/auth/google",{token:u}),{user:f,session_id:y}=v.data;i({type:"SET_USER",payload:f}),i({type:"SET_SESSION_ID",payload:y}),B.set("session_id",y,{expires:30,secure:!0,sameSite:"Strict"}),sessionStorage.setItem("session_id",y),sessionStorage.setItem("role",f.role),sessionStorage.setItem("user_id",f.id),sessionStorage.setItem("name",f.name),sessionStorage.setItem("email",f.email),n("/dashboard")}catch(u){d({visible:!0,type:"danger",message:((h=(p=u.response)==null?void 0:p.data)==null?void 0:h.message)||"Google Login failed. Please try again."})}},w=r=>{d({visible:!0,type:"danger",message:"Google login failed. Please try again."})};return o.useEffect(()=>{if(t.visible){const r=setTimeout(()=>d({...t,visible:!1}),3e3);return()=>clearTimeout(r)}},[t]),s.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:s.jsx(se,{children:s.jsx(M,{className:"justify-content-center",children:s.jsx(V,{md:8,children:s.jsx(te,{children:s.jsx(ie,{className:"p-4",children:s.jsxs(ne,{children:[s.jsxs(re,{onSubmit:C,children:[s.jsx("h1",{children:"Login"}),s.jsx("p",{className:"text-body-secondary",children:"Sign in to your account"}),t.visible&&s.jsx(P,{color:t.type,children:t.message}),s.jsxs(H,{className:"mb-3",children:[s.jsx($,{children:s.jsx(F,{icon:ae})}),s.jsx(U,{type:"email",placeholder:"Email",value:e,onChange:r=>a(r.target.value),required:!0})]}),s.jsxs(H,{className:"mb-3",children:[s.jsx($,{children:s.jsx(F,{icon:ue})}),s.jsx(U,{type:"password",placeholder:"Password",value:l,onChange:r=>g(r.target.value),required:!0})]}),s.jsx(M,{children:s.jsx(V,{xs:6,children:s.jsx(oe,{type:"submit",color:"primary",disabled:m,children:m?s.jsx(ee,{size:"sm"}):"Login"})})})]}),s.jsx("div",{className:"mt-3",children:s.jsx(ve,{clientId:"417979810176-9n90pqqm735jisrjnqlejt5hqtcnm7mu.apps.googleusercontent.com",children:s.jsx(he,{onSuccess:b,onError:w})})})]})})})})})})})};export{Ie as default};
