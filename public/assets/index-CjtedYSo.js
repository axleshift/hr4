import{r as l,x as S,i as d,j as s}from"./index-Bxp5BBYD.js";import{C as v,a as j}from"./CRow-DZ1h9d3_.js";import{C as O,a as Y}from"./CCardBody-B_S88osR.js";import{C as q}from"./CCardHeader-B9R0yHye.js";import{a as m,d as G}from"./index.esm-Dh0qthZy.js";import{C as b}from"./CFormSelect-B4EpOAEG.js";import{C as J,a as K,b as g,c as o,d as Q,e as r}from"./CTable-BmI4kmTZ.js";import{a as V,b as W,c as X,d as Z,e as _,f}from"./DefaultLayout-DkswP9-T.js";import"./CCloseButton-DgPBO7E5.js";import"./cil-user-LTq9SC4h.js";const me=()=>{const[T,p]=l.useState([]),[I,y]=l.useState([]),[C,H]=l.useState(""),[h,B]=l.useState("all"),[F,i]=l.useState(!1),[u,M]=l.useState(null),[x,N]=l.useState("pending");l.useEffect(()=>{D(),k()},[]);const D=async()=>{try{const e=await S.get("https://backend-hr1.axleshift.com/api/employees");p(e.data.data||e.data)}catch(e){console.error("Error fetching external employees:",e);try{const a=await d.get("/api/employee");p(a.data.data)}catch(a){console.error("Error fetching local employees:",a)}}},k=async()=>{try{const e=await S.get("https://backend-hr1.axleshift.com/api/newhires");y(e.data.data||e.data)}catch(e){console.error("Error fetching new hires:",e)}},$=e=>{const a=e.middleName?` ${e.middleName}`:"";return`${e.firstName}${a} ${e.lastName}`},P=e=>{switch(e){case"completed":return s.jsx(f,{color:"success",children:"Completed"});case"in progress":return s.jsx(f,{color:"warning",children:"In Progress"});case"pending":default:return s.jsx(f,{color:"secondary",children:"Pending"})}},R=e=>{M(e),N(e.status||"pending"),i(!0)},L=async()=>{if(u)try{await d.put(`/api/employee-training-status/${u.id}`,{status:x});const e=a=>a.map(n=>n.id===u.id?{...n,status:x}:n);p(a=>e(a)),y(a=>e(a)),i(!1)}catch(e){console.error("Error updating status:",e)}},E=[...T.map(e=>({...e,source:"regular"})),...I.map(e=>({...e,source:"new"}))],w=E.filter(e=>h==="new"?e.source==="new":h==="regular"?e.source==="regular":!0).filter(e=>[e.employeeId,e.firstName,e.middleName,e.lastName,e.position,e.department,e.email,e.dateHired].filter(Boolean).some(a=>a.toLowerCase().includes(C.toLowerCase()))),U=async()=>{var e;try{const a=await d.get("/api/employee"),n=a.data.data.map(t=>t.employeeId),z=a.data.data.map(t=>t.email),A=E.filter(t=>!n.includes(t.employeeId)&&!z.includes(t.email));for(const t of A)try{const c={employeeId:t.employeeId,lastName:t.lastName,firstName:t.firstName,middleName:t.middleName,position:t.position,department:t.department,dateHired:t.dateHired,email:t.email};await d.post("/api/employee",c)}catch(c){console.error(`Failed to save employee ${t.employeeId}:`,((e=c.response)==null?void 0:e.data)||c.message)}alert("Save completed.")}catch(a){console.error("Failed to save employees:",a)}};return s.jsxs(s.Fragment,{children:[s.jsx(v,{children:s.jsx(j,{xs:12,children:s.jsxs(O,{className:"mb-4",children:[s.jsxs(q,{className:"d-flex justify-content-between align-items-center",children:[s.jsx("strong",{children:"Employee Management"}),s.jsx(m,{size:"sm",color:"success",onClick:U,children:"Save to Database"})]}),s.jsxs(Y,{children:[s.jsxs(v,{className:"mb-3",children:[s.jsx(j,{md:6,children:s.jsx(G,{placeholder:"Search by ID, name, position, department, etc...",value:C,onChange:e=>H(e.target.value)})}),s.jsx(j,{md:3,children:s.jsxs(b,{value:h,onChange:e=>B(e.target.value),children:[s.jsx("option",{value:"all",children:"All Employees"}),s.jsx("option",{value:"new",children:"New Hires Only"}),s.jsx("option",{value:"regular",children:"Regular Employees Only"})]})})]}),s.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:s.jsxs(J,{align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[s.jsx(K,{children:s.jsxs(g,{children:[s.jsx(o,{children:"Employee ID"}),s.jsx(o,{children:"Name"}),s.jsx(o,{children:"Position"}),s.jsx(o,{children:"Department"}),s.jsx(o,{children:"Date Hired"}),s.jsx(o,{children:"Email"}),s.jsx(o,{className:"text-center",children:"Status"}),s.jsx(o,{className:"text-center",children:"Action"})]})}),s.jsx(Q,{children:w.length>0?w.map(e=>s.jsxs(g,{children:[s.jsx(r,{children:e.employeeId}),s.jsx(r,{children:$(e)}),s.jsx(r,{children:e.position}),s.jsx(r,{children:e.department}),s.jsx(r,{children:e.dateHired}),s.jsx(r,{children:e.email}),s.jsx(r,{className:"text-center",children:P(e.status)}),s.jsx(r,{className:"text-center",children:s.jsx(m,{color:"primary",size:"sm",onClick:()=>R(e),children:"Edit Status"})})]},e.employeeId)):s.jsx(g,{children:s.jsx(r,{colSpan:8,className:"text-center",children:"No employees found."})})})]})})]})]})})}),s.jsxs(V,{visible:F,onClose:()=>i(!1),children:[s.jsx(W,{closeButton:!0,children:s.jsx(X,{children:"Edit Training Status"})}),s.jsx(Z,{children:s.jsxs(b,{value:x,onChange:e=>N(e.target.value),children:[s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"in progress",children:"In Progress"}),s.jsx("option",{value:"completed",children:"Completed"})]})}),s.jsxs(_,{children:[s.jsx(m,{color:"secondary",onClick:()=>i(!1),children:"Cancel"}),s.jsx(m,{color:"primary",onClick:L,children:"Save"})]})]})]})};export{me as default};
